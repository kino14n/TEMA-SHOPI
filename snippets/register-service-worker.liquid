{%- comment -%}
  Snippet para registrar Service Worker
  Incluir en theme.liquid antes de </body>
{%- endcomment -%}

<script>
  // Registrar Service Worker solo en producci√≥n y HTTPS
  if ('serviceWorker' in navigator && window.location.protocol === 'https:') {
    window.addEventListener('load', () => {
      // Solo registrar en m√≥vil para mejor control
      const isMobile = window.isMobileDevice || false;
      
      if (isMobile) {
        navigator.serviceWorker.register('/service-worker.js', {
          scope: '/'
        })
        .then(registration => {
          console.log('‚úÖ Service Worker registrado:', registration.scope);
          
          // Verificar actualizaciones cada hora
          setInterval(() => {
            registration.update();
          }, 60 * 60 * 1000);
          
          // Escuchar actualizaciones
          registration.addEventListener('updatefound', () => {
            const newWorker = registration.installing;
            
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                // Hay una nueva versi√≥n disponible
                console.log('üîÑ Nueva versi√≥n del Service Worker disponible');
                
                // Opcionalmente, mostrar notificaci√≥n al usuario
                // showUpdateNotification();
              }
            });
          });
        })
        .catch(error => {
          console.error('‚ùå Error registrando Service Worker:', error);
        });
      } else {
        console.log('‚ÑπÔ∏è Service Worker deshabilitado en desktop');
      }
    });
    
    // Funci√≥n para mostrar notificaci√≥n de actualizaci√≥n (opcional)
    function showUpdateNotification() {
      if (confirm('Hay una nueva versi√≥n disponible. ¬øDeseas actualizar?')) {
        navigator.serviceWorker.getRegistration().then(registration => {
          if (registration && registration.waiting) {
            registration.waiting.postMessage({ action: 'skipWaiting' });
            window.location.reload();
          }
        });
      }
    }
    
    // Escuchar cuando el Service Worker toma control
    navigator.serviceWorker.addEventListener('controllerchange', () => {
      console.log('üîÑ Service Worker actualizado, recargando p√°gina...');
      window.location.reload();
    });
  } else {
    console.log('‚ÑπÔ∏è Service Worker no soportado o no en HTTPS');
  }
</script>
